package org.opentestsystem.ap.migration.ttsmapper;

import org.opentestsystem.ap.common.model.Item;
import org.opentestsystem.ap.common.model.WerItem;
import org.opentestsystem.ap.common.model.content.WerItemContent;
import org.springframework.stereotype.Component;

import java.util.List;

import static org.opentestsystem.ap.common.model.ItemConstants.ItemLanguage.LANG_ENU;
import static org.opentestsystem.ap.common.model.ItemConstants.ItemLanguage.LANG_ESN;

@Component
public class WerTtsMapper extends TtsMapper {

    @Override
    public void mergeEquationTTS(Item dataStoreItem, List<TtsElementInfo> ttsElementInfoList) {
        WerItem item = (WerItem) dataStoreItem;

        setEquationTTS(item.getCore().getEn(), LANG_ENU, dataStoreItem, ttsElementInfoList);
        setEquationTTS(item.getTranslations().getEsp(), LANG_ESN, dataStoreItem, ttsElementInfoList);
    }

//    @Override
//    public void updateFileNamesFromItem(ItemRelease.Item item, List<TtsElementInfo> ttsElementInfoList) {
//        item.getContent().forEach(content -> {
//            // Look for filenames on Stem
//            setFileNamesOnAccessElementInfoList(content.getStem(), ttsElementInfoList);
//            // Look for filenames on Rubric list
//            for (Serializable element : content.getRubriclist().getContent()) {
//                JAXBElement jaxbElement = (JAXBElement) element;
//                if (jaxbElement.getName().toString().equalsIgnoreCase("rubric")) {
//                    ItemRelease.Item.Content.Rubriclist.Rubric rubric =
//                            (ItemRelease.Item.Content.Rubriclist.Rubric) jaxbElement.getValue();
//                    setFileNamesOnAccessElementInfoList(rubric.getVal(), ttsElementInfoList);
//                } else if (jaxbElement.getName().toString().equals("samplelist")) {
//                    ItemRelease.Item.Content.Rubriclist.Samplelist samplelist =
//                            (ItemRelease.Item.Content.Rubriclist.Samplelist) jaxbElement.getValue();
//                    for (ItemRelease.Item.Content.Rubriclist.Samplelist.Sample sample : samplelist.getSample()) {
//                        if (StringUtils.isNotBlank(sample.getSamplecontent())) {
//                            setFileNamesOnAccessElementInfoList(sample.getSamplecontent(), ttsElementInfoList);
//                        }
//                    }
//                }
//            }
//        });
//    }

    private void setEquationTTS(WerItemContent itemContent, String language, Item dataStoreItem, List<TtsElementInfo> ttsElementInfoList) {
        itemContent.setPrompt(updateTTSOnEquationImages(
                itemContent.getPrompt(), language, dataStoreItem, ttsElementInfoList));

        itemContent.setRubric(updateTTSOnEquationImages(
                itemContent.getRubric(), language, dataStoreItem, ttsElementInfoList));

        itemContent.getExemplarResponses()
                .forEach(exemplar -> exemplar = updateTTSOnEquationImages(
                        exemplar, language, dataStoreItem, ttsElementInfoList));
    }
}
