package org.opentestsystem.ap.migration.ttsmapper;

import org.opentestsystem.ap.common.model.Item;
import org.opentestsystem.ap.common.model.MsItem;
import org.opentestsystem.ap.common.model.content.MsItemContent;
import org.springframework.stereotype.Component;

import java.util.List;

import static org.opentestsystem.ap.common.model.ItemConstants.ItemLanguage.LANG_ENU;
import static org.opentestsystem.ap.common.model.ItemConstants.ItemLanguage.LANG_ESN;

@Component
public class MsTtsMapper extends TtsMapper {

    @Override
    public void mergeEquationTTS(Item dataStoreItem, List<TtsElementInfo> ttsElementInfoList) {
        MsItem item = (MsItem) dataStoreItem;

        setEquationTTS(item.getCore().getEn(), LANG_ENU, dataStoreItem, ttsElementInfoList);
        item.getCore().getScoring().setRubric(updateTTSOnRichTextEquationImages(
                item.getCore().getScoring().getRubric(), LANG_ENU, dataStoreItem, ttsElementInfoList));

        setEquationTTS(item.getTranslations().getEsp(), LANG_ESN, dataStoreItem, ttsElementInfoList);
    }

//    @Override
//    public void updateFileNamesFromItem(ItemRelease.Item item, List<TtsElementInfo> ttsElementInfoList) {
//        item.getContent().forEach(content -> {
//            // Look for filenames on Stem
//            setFileNamesOnAccessElementInfoList(content.getStem(), ttsElementInfoList);
//            // Look for filenames in Rationale list
//            content.getRationaleoptlist().getRationale()
//                    .forEach(rationale -> setFileNamesOnAccessElementInfoList(
//                            rationale.getVal(), ttsElementInfoList));
//            // Look for filenames in Option List
//            content.getOptionlist().getOption()
//                    .forEach(option -> setFileNamesOnAccessElementInfoList(
//                            option.getVal(), ttsElementInfoList));
//        });
//    }

    private void setEquationTTS(MsItemContent itemContent, String language, Item dataStoreItem, List<TtsElementInfo> ttsElementInfoList) {
        itemContent.setPrompt(updateTTSOnRichTextEquationImages(
                itemContent.getPrompt(), language, dataStoreItem, ttsElementInfoList));

        itemContent.getOptions().forEach(option -> {
            option.setRationale(updateTTSOnRichTextEquationImages(
                    option.getRationale(), language, dataStoreItem, ttsElementInfoList));

            option.setText(updateTTSOnRichTextEquationImages(
                    option.getText(), language, dataStoreItem, ttsElementInfoList
            ));
        });
    }
}
