package org.opentestsystem.ap.migration.ttsmapper;

import org.opentestsystem.ap.common.model.Item;
import org.opentestsystem.ap.common.model.McItem;
import org.opentestsystem.ap.common.model.content.McItemContent;
import org.opentestsystem.ap.common.saaif.item.ItemRelease;
import org.springframework.stereotype.Component;

import java.util.List;

@Component
public class McTtsMapper extends TtsMapper {

    @Override
    public void mergeEquationTTS(Item dataStoreItem, List<ttsElementInfo> ttsElementInfoList) {
        McItem item = (McItem) dataStoreItem;

        setEquationTTS(item.getCore().getEn(), dataStoreItem, ttsElementInfoList);
        setEquationTTS(item.getTranslations().getEsp(), dataStoreItem, ttsElementInfoList);
    }

    @Override
    public void updateFileNamesFromItem(ItemRelease.Item item, List<ttsElementInfo> ttsElementInfoList) {
        item.getContent().forEach(content -> {
            // Look for filenames on Stem
            setFileNamesOnAccessElementInfoList(content.getStem(), ttsElementInfoList);
            // Look for filenames in Rationale list
            content.getRationaleoptlist().getRationale()
                    .forEach(rationale -> setFileNamesOnAccessElementInfoList(
                            rationale.getVal(), ttsElementInfoList));
            // Look for filenames in Option List
            content.getOptionlist().getOption()
                    .forEach(option -> setFileNamesOnAccessElementInfoList(
                            option.getVal(), ttsElementInfoList));
        });
    }

    private void setEquationTTS(McItemContent itemContent, Item dataStoreItem, List<ttsElementInfo> ttsElementInfoList) {
        itemContent.setPrompt(updateTTSOnEquationImages(
                itemContent.getPrompt(),
                dataStoreItem,
                ttsElementInfoList));

        itemContent.getOptions().forEach(option -> {
            option.setRationale(updateTTSOnEquationImages(
                    option.getRationale(),
                    dataStoreItem,
                    ttsElementInfoList
            ));
            option.setText(updateTTSOnEquationImages(
                    option.getText(),
                    dataStoreItem,
                    ttsElementInfoList
            ));
        });
    }
}