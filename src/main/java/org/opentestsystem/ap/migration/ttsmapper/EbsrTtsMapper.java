package org.opentestsystem.ap.migration.ttsmapper;

import org.opentestsystem.ap.common.model.EbsrItem;
import org.opentestsystem.ap.common.model.Item;
import org.opentestsystem.ap.common.model.content.EbsrItemContent;
import org.opentestsystem.ap.common.saaif.item.ItemRelease;
import org.springframework.stereotype.Component;

import java.util.List;

import static org.opentestsystem.ap.common.model.ItemConstants.ItemLanguage.LANG_ENU;
import static org.opentestsystem.ap.common.model.ItemConstants.ItemLanguage.LANG_ESN;

@Component
public class EbsrTtsMapper extends TtsMapper {
    @Override
    public void mergeEquationTTS(Item dataStoreItem, List<TtsElementInfo> ttsElementInfoList) {
        EbsrItem item = (EbsrItem) dataStoreItem;

        setEquationTTS(item.getCore().getEn(), LANG_ENU, dataStoreItem, ttsElementInfoList);
        setEquationTTS(item.getTranslations().getEsp(), LANG_ESN, dataStoreItem, ttsElementInfoList);
    }

    private void setEquationTTS(EbsrItemContent itemContent, String language, Item dataStoreItem, List<TtsElementInfo> ttsElementInfoList) {
        itemContent.setPrompt(this.updateTTSOnEquationImages(
                itemContent.getPrompt(), language, dataStoreItem, ttsElementInfoList));

        itemContent.setPartAPrompt(updateTTSOnEquationImages(
                itemContent.getPartAPrompt(), language, dataStoreItem, ttsElementInfoList
        ));

        itemContent.getPartAOptions().forEach(part -> {
            part.setText(updateTTSOnEquationImages(
                    part.getText(), language, dataStoreItem, ttsElementInfoList
            ));
            part.setRationale(updateTTSOnEquationImages(
                    part.getRationale(), language, dataStoreItem, ttsElementInfoList
            ));
        });

        itemContent.setPartBPrompt(updateTTSOnEquationImages(
                itemContent.getPartBPrompt(), language, dataStoreItem, ttsElementInfoList
        ));

        itemContent.getPartBOptions().forEach(part -> {
            part.setText(updateTTSOnEquationImages(
                    part.getText(), language, dataStoreItem, ttsElementInfoList
            ));
            part.setRationale(updateTTSOnEquationImages(
                    part.getRationale(), language, dataStoreItem, ttsElementInfoList
            ));
        });
    }
}
