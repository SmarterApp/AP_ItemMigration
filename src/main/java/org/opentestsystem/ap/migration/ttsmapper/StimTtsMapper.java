package org.opentestsystem.ap.migration.ttsmapper;

import org.opentestsystem.ap.common.model.Item;
import org.opentestsystem.ap.common.model.StimItem;
import org.opentestsystem.ap.common.model.content.StimItemContent;
import org.opentestsystem.ap.common.saaif.item.ItemRelease;
import org.springframework.stereotype.Component;

import java.util.List;

@Component
public class StimTtsMapper extends TtsMapper {

    @Override
    public void mergeEquationTTS(Item dataStoreItem, List<ttsElementInfo> ttsElementInfoList) {
        StimItem giDataStoreItem = (StimItem) dataStoreItem;

        setEquationTTS(giDataStoreItem.getCore().getEn(), dataStoreItem, ttsElementInfoList);
        setEquationTTS(giDataStoreItem.getTranslations().getEsp(), dataStoreItem, ttsElementInfoList);
    }

    @Override
    public void updateFileNamesFromItem(ItemRelease.Item item, List<ttsElementInfo> ttsElementInfoList) {
        // Not implemented on StimTtsMapper
    }

    public void updateFileNamesFromPassage(ItemRelease.Passage passage, List<ttsElementInfo> ttsElementInfoList) {
        passage.getContent().forEach(content -> {
            // Look for filenames on Stem
            setFileNamesOnAccessElementInfoList(content.getStem(), ttsElementInfoList);
        });
    }

    private void setEquationTTS(StimItemContent itemContent, Item dataStoreItem, List<ttsElementInfo> ttsElementInfoList) {
        itemContent.setContent(updateTTSOnEquationImages(
                itemContent.getContent(),
                dataStoreItem,
                ttsElementInfoList));
    }

}
