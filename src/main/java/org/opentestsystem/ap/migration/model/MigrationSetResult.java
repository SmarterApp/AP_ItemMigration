package org.opentestsystem.ap.migration.model;

import com.fasterxml.jackson.annotation.JsonIgnore;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.ArrayList;
import java.util.List;

@Data
@NoArgsConstructor
public class MigrationSetResult {

    @JsonIgnore
    private String itemId;

    @JsonIgnore
    private String branchName;

    private String migrationSetKey;

    private boolean isSuccess = true;

    private MigrationError migrationError;

    private List<MigrationResult> successfulMigrations = new ArrayList<>(32);

    public MigrationSetResult(String itemId, String branchName, String migrationSetKey) {
        this.itemId = itemId;
        this.branchName = branchName;
        this.migrationSetKey = migrationSetKey;
    }

    public void addMigrationError(String migrationName, String errorMessage) {
        MigrationError migrationError = new MigrationError(
            itemId, branchName, migrationSetKey, migrationName, errorMessage);

        setMigrationError(migrationError);
    }

    public void setMigrationError(MigrationError migrationError) {
        this.isSuccess = migrationError == null ? true : false;
        this.migrationError = migrationError;
    }

    public void setSuccessfulMigrations(List<MigrationResult> successfulMigrations) {
        this.successfulMigrations.clear();
        if (successfulMigrations != null) {
            this.successfulMigrations.addAll(successfulMigrations);
        }
    }

    public void addSuccessfulMigration(MigrationResult successfulMigration) {
        if (successfulMigration != null) {
            this.successfulMigrations.add(successfulMigration);
        }
    }
}
