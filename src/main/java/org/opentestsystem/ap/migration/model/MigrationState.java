package org.opentestsystem.ap.migration.model;

import java.util.Collection;
import java.util.HashSet;
import java.util.List;
import java.util.Set;
import java.util.stream.Collectors;

import lombok.Data;
import org.apache.commons.lang3.StringUtils;

import static org.apache.commons.collections4.CollectionUtils.isNotEmpty;

@Data
public class MigrationState {

    private Set<BranchMigration> migrations = new HashSet<>(0);

    public BranchMigration getBranchMigration(final String branchName) {
        final List<BranchMigration> list = migrations.stream().filter(
            branchMigration -> StringUtils.equalsIgnoreCase(branchMigration.getBranchName(), branchName)
        ).collect(Collectors.toList());
        return isNotEmpty(list) ? list.get(0) : new BranchMigration(branchName);
    }

    public void setMigrations(final Collection<BranchMigration> migrations) {
        this.migrations.clear();
        if (migrations != null) {
            this.migrations.addAll(migrations);
        }
    }

    public void updateMigrations(final BranchMigration branchMigration) {
        migrations.remove(branchMigration);
        migrations.add(branchMigration);
    }
}
