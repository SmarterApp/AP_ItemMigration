package org.opentestsystem.ap.migration.service;

import lombok.extern.slf4j.Slf4j;
import org.apache.commons.collections4.CollectionUtils;
import org.opentestsystem.ap.common.datastore.DataStoreAttachmentManager;
import org.opentestsystem.ap.migration.ApplicationProperties;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import java.util.List;

import static org.apache.commons.collections4.ListUtils.emptyIfNull;

@Slf4j
@Component
public class AttachmentService {

    @Autowired
    private ApplicationProperties applicationProperties;

    @Autowired
    private DataStoreAttachmentManager manager;

    public void listAttachmentItems() {
        applicationProperties.getAttachmentItems()
                .stream()
                .map(this::getAttachments)
                .forEach(this::deleteAttachments);

    }

    public List<String> getAttachments(ApplicationProperties.AttachmentItem attachmentItem) {
        log.info("Looking up attachments for item -> {} and branch -> {}",
                attachmentItem.getItemId(), attachmentItem.getBranch());
        return emptyIfNull(manager.findAttachments(attachmentItem.getItemId(), attachmentItem.getBranch()));
    }

    public void deleteAttachments(List<String> attachments) {
        if (CollectionUtils.isNotEmpty(attachments)) {
            //        attachments.stream().forEach(amazonClient::deleteFile);
            attachments.stream().forEach(System.out::println);
        } else {
            log.info("No attachments to delete");
        }
    }
}
