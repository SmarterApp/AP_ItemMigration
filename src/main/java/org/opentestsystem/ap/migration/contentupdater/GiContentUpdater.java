package org.opentestsystem.ap.migration.contentupdater;

import org.opentestsystem.ap.common.model.GiItem;
import org.opentestsystem.ap.common.model.content.GiItemContent;

import static org.opentestsystem.ap.common.model.ModelConstants.ItemLanguage.LANG_ESN;

public class GiContentUpdater extends AbstractContentUpdater<GiItem> {

    @Override
    protected boolean updateEnglishContent(GiItem item, ContentUpdateCommand updateCommand) {
        boolean isContentChanged;
        GiItemContent englishContent = item.getCore().getEn();

        ContentUpdateCommandResult commandResult = updateCommand.applyEnglishContentUpdate(englishContent.getPrompt());
        englishContent.setPrompt(commandResult.getUpdatedContent());
        isContentChanged = commandResult.isContentChanged();

        commandResult = updateCommand.applyEnglishContentUpdate(item.getCore().getScoring().getRubric());
        item.getCore().getScoring().setRubric(commandResult.getUpdatedContent());
        isContentChanged = isContentChanged || commandResult.isContentChanged();

        return isContentChanged;
    }

    @Override
    protected boolean updateSpanishContent(GiItem item, ContentUpdateCommand updateCommand) {
        GiItemContent englishContent = item.getCore().getEn();
        GiItemContent spanishContent = item.getTranslations().getEsp();

        ContentUpdateCommandResult commandResult = updateCommand.applyTranslatedContentUpdate(
                LANG_ESN,
                spanishContent.getPrompt(),
                englishContent.getPrompt()
        );
        spanishContent.setPrompt(commandResult.getUpdatedContent());

        return commandResult.isContentChanged();
    }
}
