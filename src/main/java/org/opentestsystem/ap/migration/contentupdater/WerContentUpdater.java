package org.opentestsystem.ap.migration.contentupdater;

import org.opentestsystem.ap.common.model.Item;
import org.opentestsystem.ap.common.model.ItemConstants;
import org.opentestsystem.ap.common.model.WerItem;
import org.opentestsystem.ap.common.model.content.WerItemContent;

@FixFor(type = ItemConstants.ItemType.TYPE_WER)
public class WerContentUpdater extends ContentUpdater {
    @Override
    public void updateContent(Item item, ContentUpdateCommand contentUpdateCommand) {
        this.updateCommand = contentUpdateCommand;
        WerItem werItem = (WerItem) item;
        updateItemContent(werItem.getCore().getEn());
        updateItemContent(werItem.getTranslations().getEsp());
    }

    private void updateItemContent(WerItemContent content) {
        content.setPrompt(this.updateCommand.applyContentUpdate(content.getPrompt()));
        content.setRubric(this.updateCommand.applyContentUpdate(content.getRubric()));
        content.getExemplarResponses().replaceAll(
                exemplar -> this.updateCommand.applyContentUpdate(exemplar));
    }
}
