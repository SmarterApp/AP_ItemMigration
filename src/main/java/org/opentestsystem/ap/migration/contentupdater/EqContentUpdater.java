package org.opentestsystem.ap.migration.contentupdater;

import org.opentestsystem.ap.common.model.EqItem;
import org.opentestsystem.ap.common.model.Item;
import org.opentestsystem.ap.common.model.ItemConstants;
import org.opentestsystem.ap.common.model.content.EqItemContent;

import static org.opentestsystem.ap.common.model.ItemConstants.ItemLanguage.LANG_ESN;

public class EqContentUpdater implements ContentUpdater {

    @Override
    public void updateContent(Item item, ContentUpdateCommand contentUpdateCommand) {
        EqItem eqItem = (EqItem) item;
        this.updateEnglishContent(eqItem, contentUpdateCommand);
        this.updateTranslationContent(eqItem, contentUpdateCommand);
    }

    private void updateEnglishContent(EqItem eqItem, ContentUpdateCommand updateCommand) {
        EqItemContent english = eqItem.getCore().getEn();

        english.setPrompt(
            updateCommand.applyContentUpdate(english.getPrompt()));

        eqItem.getCore().getScoring().setRubric(
            updateCommand.applyContentUpdate(eqItem.getCore().getScoring().getRubric()));
    }

    private void updateTranslationContent(EqItem eqItem, ContentUpdateCommand updateCommand) {
        EqItemContent english = eqItem.getCore().getEn();
        EqItemContent spanish = eqItem.getTranslations().getEsp();
        spanish.setPrompt(updateCommand.applyContentUpdate(LANG_ESN, spanish.getPrompt(), english.getPrompt()));
    }
}
