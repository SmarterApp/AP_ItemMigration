package org.opentestsystem.ap.migration.contentupdater;

import org.opentestsystem.ap.common.model.TiItem;
import org.opentestsystem.ap.common.model.content.TiItemContent;

import static org.opentestsystem.ap.common.model.ModelConstants.ItemLanguage.LANG_ESN;

public class TiContentUpdater extends AbstractContentUpdater<TiItem> {

    @Override
    protected void updateEnglishContent(TiItem item, ContentUpdateCommand updateCommand) {
        TiItemContent content = item.getCore().getEn();

        content.setPrompt(updateCommand.applyEnglishContentUpdate(content.getPrompt()));
        content.getTable().setTitle(updateCommand.applyEnglishContentUpdate(content.getTable().getTitle()));

        item.getCore().getScoring().setRubric(
            updateCommand.applyEnglishContentUpdate(item.getCore().getScoring().getRubric()));

        this.updateEnglishTable(content.getTable(), updateCommand, !LABELS_ONLY);
    }

    @Override
    protected void updateSpanishContent(TiItem item, ContentUpdateCommand updateCommand) {
        TiItemContent english = item.getCore().getEn();
        TiItemContent spanish = item.getTranslations().getEsp();

        spanish.setPrompt(updateCommand.applyTranslatedContentUpdate(LANG_ESN, spanish.getPrompt(), english.getPrompt()));

        spanish.getTable().setTitle(
            updateCommand.applyTranslatedContentUpdate(
                LANG_ESN,
                spanish.getTable().getTitle(),
                english.getTable().getTitle()));

        this.updateSpanishTableColumns(
            spanish.getTable().getColumns(), english.getTable().getColumns(), updateCommand);

        this.updateSpanishTableRows(
            spanish.getTable().getRows(), english.getTable().getRows(), updateCommand, !LABELS_ONLY);
    }
}
