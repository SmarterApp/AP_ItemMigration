package org.opentestsystem.ap.migration.contentupdater;

import org.opentestsystem.ap.common.model.Item;
import org.opentestsystem.ap.common.model.ItemConstants;
import org.opentestsystem.ap.common.model.TiItem;
import org.opentestsystem.ap.common.model.content.TiItemContent;

@UpdateFor(type = ItemConstants.ItemType.TYPE_TI)
public class TiContentUpdater extends ContentUpdater {
    @Override
    public void updateContent(Item item, ContentUpdateCommand contentUpdateCommand) {
        this.updateCommand = contentUpdateCommand;
        TiItem tiItem = (TiItem) item;
        updateItemContent(tiItem.getCore().getEn());
        updateItemContent(tiItem.getTranslations().getEsp());
    }

    private void updateItemContent(TiItemContent content) {
        content.setPrompt(this.updateCommand.applyContentUpdate(content.getPrompt()));
        content.getTable().setTitle(this.updateCommand.applyContentUpdate(content.getTable().getTitle()));
        content.getTable().getColumns().forEach(column ->
            column.setLabel(this.updateCommand.applyContentUpdate(column.getLabel()))
        );
        content.getTable().getRows().forEach(row -> {
            row.getCells().forEach(cell ->
                cell.setValue(this.updateCommand.applyContentUpdate((String) cell.getValue()))
            );
        });
    }
}
