package org.opentestsystem.ap.migration.contentupdater;

import org.opentestsystem.ap.common.model.SaItem;
import org.opentestsystem.ap.common.model.content.SaItemContent;

import static org.opentestsystem.ap.common.model.ModelConstants.ItemLanguage.LANG_ESN;

public class SaContentUpdater extends AbstractContentUpdater<SaItem> {

    @Override
    protected boolean updateEnglishContent(SaItem item, ContentUpdateCommand updateCommand) {
        boolean isContentChanged;
        SaItemContent content = item.getCore().getEn();

        ContentUpdateCommandResult commandResult = updateCommand.applyEnglishContentUpdate(content.getPrompt());
        content.setPrompt(commandResult.getUpdatedContent());
        isContentChanged = commandResult.isContentChanged();

        for (int i = 0; i < content.getRubrics().size(); i++) {
            commandResult = updateCommand.applyEnglishContentUpdate(content.getRubrics().get(i));
            content.getRubrics().set(i, commandResult.getUpdatedContent());
            isContentChanged = isContentChanged || commandResult.isContentChanged();
        }

        for (int i = 0; i < content.getExemplarResponses().size(); i++) {
            commandResult = updateCommand.applyEnglishContentUpdate(content.getExemplarResponses().get(i));
            content.getExemplarResponses().set(i, commandResult.getUpdatedContent());
            isContentChanged = isContentChanged || commandResult.isContentChanged();
        }

        return isContentChanged;
    }

    @Override
    protected boolean updateSpanishContent(SaItem item, ContentUpdateCommand updateCommand) {
        boolean isContentChanged;
        SaItemContent english = item.getCore().getEn();
        SaItemContent spanish = item.getTranslations().getEsp();

        ContentUpdateCommandResult commandResult =
                updateCommand.applyTranslatedContentUpdate(LANG_ESN, spanish.getPrompt(), english.getPrompt());
        spanish.setPrompt(commandResult.getUpdatedContent());
        isContentChanged = commandResult.isContentChanged();

        boolean rubricsChanged = this.updateSpanishListOfStrings(
                spanish.getRubrics(), english.getRubrics(), updateCommand);
        isContentChanged = isContentChanged || rubricsChanged;

        boolean exemplarChanged =  this.updateSpanishListOfStrings(
                spanish.getExemplarResponses(), english.getExemplarResponses(), updateCommand);
        isContentChanged = isContentChanged || exemplarChanged;

        return isContentChanged;
    }
}

