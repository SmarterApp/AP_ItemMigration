package org.opentestsystem.ap.migration.contentupdater;

import org.opentestsystem.ap.common.model.HtqsItem;
import org.opentestsystem.ap.common.model.content.HtqsItemContent;

import static org.opentestsystem.ap.common.model.ModelConstants.ItemLanguage.LANG_ESN;

public class HtqsContentUpdater extends AbstractContentUpdater<HtqsItem> {

    @Override
    protected boolean updateEnglishContent(HtqsItem item, ContentUpdateCommand updateCommand) {
        boolean isContentChanged;
        HtqsItemContent englishContent = item.getCore().getEn();
        ContentUpdateCommandResult commandResult = updateCommand.applyEnglishContentUpdate(englishContent.getPrompt());
        englishContent.setPrompt(commandResult.getUpdatedContent());
        isContentChanged = commandResult.isContentChanged();

        commandResult = updateCommand.applyEnglishContentUpdate(englishContent.getHtqSelectable().getInteractiveText());
        englishContent.getHtqSelectable().setInteractiveText(commandResult.getUpdatedContent());
        isContentChanged = isContentChanged || commandResult.isContentChanged();

        commandResult = updateCommand.applyEnglishContentUpdate(item.getCore().getScoring().getRubric());
        item.getCore().getScoring().setRubric(commandResult.getUpdatedContent());
        isContentChanged = isContentChanged || commandResult.isContentChanged();

        return isContentChanged;
    }

    @Override
    protected boolean updateSpanishContent(HtqsItem item, ContentUpdateCommand updateCommand) {
        boolean isContentChanged;
        HtqsItemContent englishContent = item.getCore().getEn();
        HtqsItemContent spanishContent = item.getTranslations().getEsp();

        ContentUpdateCommandResult commandResult = updateCommand.applyTranslatedContentUpdate(
                LANG_ESN,
                spanishContent.getPrompt(),
                englishContent.getPrompt()
        );
        spanishContent.setPrompt(commandResult.getUpdatedContent());
        isContentChanged = commandResult.isContentChanged();

        commandResult = updateCommand.applyTranslatedContentUpdate(
                LANG_ESN,
                spanishContent.getHtqSelectable().getInteractiveText(),
                englishContent.getHtqSelectable().getInteractiveText());
        spanishContent.getHtqSelectable().setInteractiveText(commandResult.getUpdatedContent());
        isContentChanged = isContentChanged || commandResult.isContentChanged();

        return isContentChanged;
    }
}
