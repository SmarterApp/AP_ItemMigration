package org.opentestsystem.ap.migration.contentupdater;

import org.opentestsystem.ap.common.model.EbsrItem;
import org.opentestsystem.ap.common.model.Item;
import org.opentestsystem.ap.common.model.ItemConstants;
import org.opentestsystem.ap.common.model.content.EbsrItemContent;

/**
 * Ebsr Content Updater
 */
@FixFor(type = ItemConstants.ItemType.TYPE_EBSR)
public class EbsrContentUpdater extends ContentUpdater {
    @Override
    public void updateContent(Item item, ContentUpdateCommand contentUpdateCommand) {
        this.updateCommand = contentUpdateCommand;
        EbsrItem ebsrItem = (EbsrItem) item;
        updateItemContent(ebsrItem.getCore().getEn());
        updateItemContent(ebsrItem.getTranslations().getEsp());
    }

    private void updateItemContent(EbsrItemContent content) {
        content.setPrompt(this.updateCommand.applyContentUpdate(content.getPrompt()));
        content.setPartAPrompt(this.updateCommand.applyContentUpdate(content.getPartAPrompt()));
        content.setPartBPrompt(this.updateCommand.applyContentUpdate(content.getPartBPrompt()));
        content.getPartAOptions().forEach(itemOption -> {
            itemOption.setRationale(this.updateCommand.applyContentUpdate(itemOption.getRationale()));
            itemOption.setText(this.updateCommand.applyContentUpdate(itemOption.getText()));
        });
        content.getPartBOptions().forEach(itemOption -> {
            itemOption.setRationale(this.updateCommand.applyContentUpdate(itemOption.getRationale()));
            itemOption.setText(this.updateCommand.applyContentUpdate(itemOption.getText()));
        });
    }
}
