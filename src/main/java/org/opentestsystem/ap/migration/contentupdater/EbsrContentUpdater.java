package org.opentestsystem.ap.migration.contentupdater;

import org.opentestsystem.ap.common.model.EbsrItem;
import org.opentestsystem.ap.common.model.content.EbsrItemContent;

import static org.opentestsystem.ap.common.model.ItemConstants.ItemLanguage.LANG_ESN;

/**
 * Ebsr Content Updater
 */
public class EbsrContentUpdater extends AbstractContentUpdater<EbsrItem> {

    @Override
    protected void updateEnglishContent(EbsrItem item, ContentUpdateCommand updateCommand) {
        EbsrItemContent content = item.getCore().getEn();
        content.setPrompt(updateCommand.applyEnglishContentUpdate(content.getPrompt()));

        content.setPartAPrompt(updateCommand.applyEnglishContentUpdate(content.getPartAPrompt()));
        content.setPartBPrompt(updateCommand.applyEnglishContentUpdate(content.getPartBPrompt()));

        content.getPartAOptions().forEach(itemOption -> {
            itemOption.setRationale(updateCommand.applyEnglishContentUpdate(itemOption.getRationale()));
            itemOption.setText(updateCommand.applyEnglishContentUpdate(itemOption.getText()));
        });

        content.getPartBOptions().forEach(itemOption -> {
            itemOption.setRationale(updateCommand.applyEnglishContentUpdate(itemOption.getRationale()));
            itemOption.setText(updateCommand.applyEnglishContentUpdate(itemOption.getText()));
        });
    }

    @Override
    protected void updateSpanishContent(EbsrItem item, ContentUpdateCommand updateCommand) {
        EbsrItemContent english = item.getCore().getEn();
        EbsrItemContent spanish = item.getTranslations().getEsp();

        spanish.setPrompt(updateCommand.applyTranslatedContentUpdate(
            LANG_ESN, spanish.getPrompt(), english.getPrompt()));

        spanish.setPartAPrompt(updateCommand.applyTranslatedContentUpdate(
            LANG_ESN, spanish.getPartAPrompt(), english.getPartAPrompt()));

        spanish.setPartBPrompt(updateCommand.applyTranslatedContentUpdate(
            LANG_ESN, spanish.getPartBPrompt(), english.getPartBPrompt()));

        this.updateSpanishItemOptions(spanish.getPartAOptions(), english.getPartAOptions(), updateCommand);
        this.updateSpanishItemOptions(spanish.getPartBOptions(), english.getPartBOptions(), updateCommand);
    }
}
