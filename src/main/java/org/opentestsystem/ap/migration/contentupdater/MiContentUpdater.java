package org.opentestsystem.ap.migration.contentupdater;

import org.opentestsystem.ap.common.model.Item;
import org.opentestsystem.ap.common.model.MiItem;
import org.opentestsystem.ap.common.model.content.MiItemContent;

public class MiContentUpdater implements ContentUpdater {
    @Override
    public void updateContent(Item item,
                              ContentUpdateCommand contentUpdateCommand) {
        MiItem miItem = (MiItem) item;
        updateItemContent(miItem.getCore().getEn(), contentUpdateCommand);
        updateItemContent(miItem.getTranslations().getEsp(), contentUpdateCommand);
    }

    private void updateItemContent(MiItemContent content,
                                   ContentUpdateCommand updateCommand) {
        content.setPrompt(updateCommand.applyContentUpdate(content.getPrompt()));
        content.getTable().getColumns().forEach(column ->
            column.setLabel(updateCommand.applyContentUpdate(column.getLabel()))
        );
        content.getTable().getRows().forEach(row -> {
            row.getCells().forEach(cell -> {
                if (cell.getType().equals("label")) {
                    cell.setValue(updateCommand.applyContentUpdate((String) cell.getValue()));
                }
            });
        });
    }
}
