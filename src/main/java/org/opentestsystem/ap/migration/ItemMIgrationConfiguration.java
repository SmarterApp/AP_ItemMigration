package org.opentestsystem.ap.migration;

import freemarker.template.Configuration;
import freemarker.template.TemplateExceptionHandler;
import lombok.extern.slf4j.Slf4j;
import org.opentestsystem.ap.common.assembler.StringAssembler;
import org.springframework.context.annotation.Bean;

import static freemarker.template.Configuration.VERSION_2_3_25;

@Slf4j
@org.springframework.context.annotation.Configuration
public class ItemMIgrationConfiguration {

    private final ApplicationProperties applicationProperties;

    public ItemMIgrationConfiguration(ApplicationProperties applicationProperties) {
        this.applicationProperties = applicationProperties;
    }

    @Bean
    public StringAssembler migrationStringAssembler() {
        final Configuration freemarkerConfig = new Configuration(VERSION_2_3_25);

        freemarkerConfig.setClassForTemplateLoading(this.getClass(), applicationProperties.getReportTemplateFolder());

        freemarkerConfig.setTemplateExceptionHandler(TemplateExceptionHandler.RETHROW_HANDLER);
        freemarkerConfig.setDefaultEncoding("UTF-8");

        return new StringAssembler(freemarkerConfig);
    }
}
