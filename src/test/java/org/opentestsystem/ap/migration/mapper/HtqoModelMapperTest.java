package org.opentestsystem.ap.migration.mapper;

import org.junit.Before;
import org.junit.Test;
import org.opentestsystem.ap.common.model.HtqoItem;
import org.opentestsystem.ap.common.model.ItemConstants;
import org.opentestsystem.ap.common.saaif.item.ItemRelease;
import org.opentestsystem.ap.common.saaif.mapper.HtqoModelMapper;
import org.opentestsystem.ap.common.saaif.model.ItemMappingResult;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;

import static org.assertj.core.api.Assertions.assertThat;

public class HtqoModelMapperTest {
    private static final String englishStem = "<p style=\"\">A student is writing a report for her teacher about a class project on state capitals. The student wants to revise the draft so that the sentence order makes sense. <span id=\"item_110194_TAG_11_BEGIN\">Read</span> the draft of the report and complete the task that follows.</p><p style=\"\"> </p><ul class=\"interaction order-group\" id=\"interaction-1\" data-its-identifier=\"1\"><li class=\"interaction order-choice\" data-its-identifier=\"1\" data-its-group=\"1\"><span id=\"item_110194_TAG_1_BEGIN\">Last month, our class completed group projects on state capitals.</span></li><li class=\"interaction order-choice\" data-its-identifier=\"2\" data-its-group=\"1\"><span id=\"item_110194_TAG_2_BEGIN\">Our group was assigned Augusta, Maine.</span></li><li class=\"interaction order-choice\" data-its-identifier=\"3\" data-its-group=\"1\"><span id=\"item_110194_TAG_3_BEGIN\">Then we took notes on note cards and organized them before writing the report.</span></li><li class=\"interaction order-choice\" data-its-identifier=\"4\" data-its-group=\"1\"><span id=\"item_110194_TAG_4_BEGIN\">We began by going to the library to find books about Maine.</span></li><li class=\"interaction order-choice\" data-its-identifier=\"5\" data-its-group=\"1\"><span id=\"item_110194_TAG_5_BEGIN\">We cut out magazine pictures and pasted them onto our poster.</span></li><li class=\"interaction order-choice\" data-its-identifier=\"6\" data-its-group=\"1\"><span id=\"item_110194_TAG_6_BEGIN\">The first group of notes was about Augusta's history, so we began our report with that.</span></li><li class=\"interaction order-choice\" data-its-identifier=\"7\" data-its-group=\"1\"><span id=\"item_110194_TAG_7_BEGIN\">Once we finished our report, we decided to make a poster of fun things to do in Augusta.</span></li><li class=\"interaction order-choice\" data-its-identifier=\"8\" data-its-group=\"1\"><span id=\"item_110194_TAG_8_BEGIN\">Our project was the best in the class!</span></li></ul><p style=\"\"> </p><p style=\"\"><span style=\"font-weight:bold; \">Two</span> sentences in the report are out of order. Move the sentences to the right places in the paragraph.</p>";

    private HtqoModelMapper mapper;

    @Before
    public void setUp() {
        mapper = new HtqoModelMapper();
    }

    @Test
    public void shouldMapStem() throws IOException {
        ItemRelease itemRelease = new ItemRelease();
        ItemRelease.Item item = new ItemRelease.Item();
        ItemRelease.Item.Content content = new ItemRelease.Item.Content();
        content.setStem(englishStem);
        content.setLanguage(ItemConstants.ItemLanguage.LANG_ENU);
        item.getContent().add(content);
        itemRelease.setItem(item);

        HtqoItem htqoItem = new HtqoItem("123");
        Path tempDir = Files.createTempDirectory("HtqoModelMapperTest_temp");
        Path itemDir = Files.createTempDirectory("HtqoModelMapperTest_item");
        ItemMappingResult mappingResult = new ItemMappingResult();

        HtqoItem mappedItem = (HtqoItem) mapper.mapContent(htqoItem, itemRelease, tempDir, itemDir.toString(), mappingResult);

        assertThat(mappedItem.getCore().getEn().getPrompt()).contains("student is writing a report");
        assertThat(mappedItem.getCore().getEn().getPrompt()).contains("sentences in the report");
    }
}